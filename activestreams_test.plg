<?xml version='1.0' standalone='yes'?>
<!DOCTYPE PLUGIN [
<!ENTITY name      "activestreams">
<!ENTITY author    "gthrift">
<!ENTITY version   "2026.02.03-beta1">
<!ENTITY sha256    "22ffcf7a57af6743ef4e87e637cbe5cec59d6e99f4f1d422ad7299aab915c34a">
<!ENTITY launch    "Settings/ActiveStreamsSettings">
<!ENTITY gitURL    "https://raw.githubusercontent.com/gthrift/activestreams-unraid/main">
<!ENTITY archive   "&gitURL;/archive/&name;-&version;.txz">
<!ENTITY emhttp    "/usr/local/emhttp/plugins/&name;">
<!ENTITY plgPATH   "/boot/config/plugins/&name;">
]>

<PLUGIN name="&name;"
        author="&author;"
        version="&version;"
        launch="&launch;"
        pluginURL="&gitURL;/activestreams_test.plg"
        support="https://forums.unraid.net/topic/196336-plugin-active-streams-display-your-active-embyjellyfinplex-streams-on-your-dashboard/"
        project="https://github.com/gthrift/activestreams-unraid"
        readme="https://github.com/gthrift/activestreams-unraid#readme"
        IconFA="film"
        icon="streams.png"
        min="6.12.0">

<CHANGES>
###2026.02.03-beta1
- Beta build for testing

###2026.02.02-beta8
- Beta build for testing

###2026.02.02-beta7
- Beta build for testing

###2026.02.02-beta6
- Beta build for testing

###2026.02.02-beta5
- Beta build for testing

###2026.02.02-beta4
- Beta build for testing

###2026.02.02-beta3
- Beta build for testing

###2026.02.02-beta2
- fix width

###2026.02.02-beta1
- Fix widget width

###2026.02.02-beta1
- Beta build for testing

###2026.02.02-beta1
- Beta build for testing
- Now installs from pre-built archive (same as production)
- Includes SHA256 verification

###2026.01.08-TEST
- TEST VERSION: Downloads files directly from GitHub src/ directory
- Security improvements: Token encryption, CSRF protection, SSL verification
- DO NOT USE IN PRODUCTION

###2026.01.07
- Rename ActiveStreams.page to ActiveStreamsDashboard.page to resolve issue with Dynamix Active Streams
</CHANGES>

<OVERVIEW>
BETA VERSION - For testing new features before production release.

A plugin to create a dashboard widget that shows your active streams from Plex, Emby, and Jellyfin servers.

BETA TESTING:
1. This version installs from a pre-built archive (like production)
2. SHA256 hash verification ensures file integrity
3. Uninstall before installing production version

To install a specific beta branch, use this URL format:
https://raw.githubusercontent.com/gthrift/activestreams-unraid/BRANCH_NAME/activestreams_test.plg
</OVERVIEW>

<FILE Run="/bin/bash">
        <INLINE>
                echo "================================================"
                echo " Installing BETA version of Active Streams"
                echo " Version: &version;"
                echo "================================================"

                # Remove old webUI files to prevent conflicts
                rm -f "&emhttp;/*.page"
                rm -f "&emhttp;/*.php"

                # Create Config Directory before download attempts to write to it
                mkdir -p "&plgPATH;"
        </INLINE>
</FILE>

<FILE Name="&plgPATH;/&name;-&version;.txz" Run="upgradepkg --install-new --reinstall">
    <URL>&archive;</URL>
    <SHA256>&sha256;</SHA256>
</FILE>

<!-- Cache the package locally for faster boot (avoids re-download) -->
<FILE Name="&plgPATH;/&name;-&version;.txz">
    <LOCAL>&plgPATH;/&name;-&version;.txz</LOCAL>
</FILE>

<FILE Run="/bin/bash">
        <INLINE>
                # Set Default Config if missing
                if [ ! -f "&plgPATH;/activestreams.cfg" ]; then
                    echo "POLL_INTERVAL='5'" > "&plgPATH;/activestreams.cfg"
                    echo "WIDGET_ICON='streams'" >> "&plgPATH;/activestreams.cfg"
                    echo "WIDGET_TITLE='Active Streams'" >> "&plgPATH;/activestreams.cfg"
                    echo "Created default config"
                fi

                # Create empty servers config if missing
                if [ ! -f "&plgPATH;/servers.json" ]; then
                    echo "[]" > "&plgPATH;/servers.json"
                    echo "Created empty servers.json"
                fi

                # Set restrictive permissions on files containing sensitive tokens
                chmod 600 "&plgPATH;/servers.json"

                echo ""
                echo "-----------------------------------------------------------"
                echo " BETA version of &name; has been installed."
                echo " Version: &version;"
                echo ""
                echo " Config directory: &plgPATH;"
                echo ""
                echo " REMINDER: This is a BETA installation"
                echo " Uninstall before using production version"
                echo "-----------------------------------------------------------"
                echo ""
        </INLINE>
</FILE>

<FILE Run="/bin/bash" Method="remove">
        <INLINE>
                echo "Uninstalling BETA version of &name;..."

                # uninstall plugin
                removepkg &plgPATH;/*.txz

                rm -rf &emhttp;
                rm -rf &plgPATH;/*.txz \
                       &plgPATH;/*.md5 \
                       &plgPATH;/*.sha256

                # Configuration files are preserved for future reinstallation
                # To manually remove configs, delete: &plgPATH;/activestreams.cfg and &plgPATH;/servers.json

                echo ""
                echo "-----------------------------------------------------------"
                echo " BETA version of &name; has been uninstalled."
                echo " Your server configurations have been preserved at:"
                echo " &plgPATH;/"
                echo ""
                echo " To completely remove all settings, manually delete:"
                echo " &plgPATH;/activestreams.cfg"
                echo " &plgPATH;/servers.json"
                echo "-----------------------------------------------------------"
                echo ""
        </INLINE>
</FILE>

</PLUGIN>
